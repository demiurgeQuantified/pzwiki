#!/bin/bash

cd $(dirname "${0}")
cd ..

JAVAROOT=$(jq .java.root config.json | tr -d '"')

CORE="$(find "${JAVAROOT}" -name Core.java)"
if [ -z "${CORE}" ]; then
	echo 'Cannot find Core.java!'
	exit
fi

VERSION="$(grep 'new GameVersion' "${CORE}" | cut -f2 -d'(' | awk -F',' '{ print $1 $2 }' | sed 's/[ ]\+/./')"
if [ -z "${VERSION}" ]; then
	echo 'Cannot find game version!'
	exit
fi

OUTPUT1="data/txt/events.txt"
OUTPUT2="data/wiki/events.wiki"
echo -n > "${OUTPUT1}"
echo -n > "${OUTPUT2}"

echo "== Version ${VERSION} ==" >> "${OUTPUT2}"
while read LINE; do

	echo "${LINE}" >> "${OUTPUT1}"

	DEPRECATED="$(grep "^${LINE}$" "data/txt/deprecated.txt")"
	if [ -z "${DEPRECATED}" ]; then
		echo "*[[Modding:Lua Events/$LINE|$LINE]]" >> "${OUTPUT2}"
	else
		echo "*<s>[[Modding:Lua Events/$LINE|$LINE]]</s>" >> "${OUTPUT2}"
	fi

done < <(cat "data/txt/addeventjava.txt" "data/txt/addeventlua.txt" | sort -u)
